---
title: "yangy22-data-replication-assignment"
author: "Emily Yang"
date: "`r Sys.Date()`"
output: 
  prettydoc::html_pretty:
    theme: cayman
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# A rodent herbivore reduces its predation risk through ecosystem engineering

## Background

The environment plays a role in predator-prey relationships. This paper studied Brandtâ€™s voles which modify their habitat by cutting down bunchgrass (Achnatherum splendens) in the presence of shrikes. A. splendens is unpalatable and voles don't eat it. Shrike perch on bunchgrasses to hunt voles and impale voles onto bunchgrass spikes for later.  By decreasing the volume of bunchgrass voles reduced visitations by shrikes and vole mortality rates drop. Their ecosystem engineering through damaging roots and clipping leaves can directly reduce their own predation risk by modifying habitat structure. 

## Data Description
The data set I used was deposited on Dryad. 
Column A-E: Data used to generate Figure 2A
Column G-K: Data used to generate Figure 2B
Column R-X: Data used to generate Figure 4 

```{r data}
library(dplyr)
library(tidyverse)
library(ggplot2)
library(ggpubr)

d <- read.csv("Ecosystem_engineers_and_predation_risk_data_-.csv")
head(d)
```
## Figure 2A
 
Inferential Statistic + Figure Replication<br>

<img src="img/Figure 2.png" width="400px" height="600px"><br>

Figure 2 was about observing randomly 15 pairs of randomly selected A. splendens grass bunches 15 with voles and 15 without. They recorded the presence of voles and presence of birds and found that vole presence had an effect on A. splendens size and the amount of grass coverage affected how often predatory shrikes would visit. <br>

```{r Fig2A}
n <- d %>%
 group_by(Vole_Presence) %>%
  summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())), Change_plantvol)
n
m <- as.data.frame(n)

g <- ggplot(m) +
  geom_col(aes(y=mean, x=Vole_Presence), fill="forestgreen") + #add columns
  geom_errorbar( aes(x=Vole_Presence,ymin=mean-se, ymax=mean+se), width=0.2, colour="black") + #add error bars. Can't make single sided error bars
ylab("Change in plant volume (m3)") + ylim(-1.5, 1.5) + # adjusting y axis
  annotate('text', x = 1.5, y = 1, label='"*"', parse=TRUE) # add significance from the anova below. Only one star used because the paper only marked signif and not degree. 
                 
g

```
<br>I summarized change in plant volume according to vole presence and made a barplot. The error bars are mean +/- the standard error. Using the inferential anova below I decided that the difference in the means was significantly different. 


They found that the average plant volume of A. splendens grass, given vole presence, was reduced by 0.63 m3, whereas the average plant volume of A. splendens in the absence of voles increased by 0.49 m3, as compared to the initial conditions (F1, 14 = 15.09; p = 0.0017; Figure 2A). I tested the data using a repeated measures anova. 

```{r 2A Inferential Statistics}

# Repeated measures anova change in plant volume predicted by vole presence.
model <- aov(Change_plantvol~factor(Vole_Presence)+Error(factor(Pair_number)), data = d)
summary(model)
```
I chose a repeated measures anova because I wanted to see if there was a significant difference in the change in plant volume of each paired group. I found the same F and p values with a significance of 0.01. The authors didn't say what type of test was used to get their statistical results. I had tried a one way anova and gotten values that were close but double the degrees of freedom. 

## Figure 2B
```{r Fig2B}
m <- d[ ,c(7,11)] 
head(m)

ggplot(m, aes(x=as.numeric(Plant_cover), y=as.numeric(Birds_total15))) +
  geom_point(colour = "forestgreen", size = 5) + 
  geom_smooth(method = "lm", se=FALSE) +
  xlab("A. splendens cover %") + ylab("No. of visits by predatory birds/plot")

  
```

The total number of visits by predatory birds per plot was positively correlated with the coverage of A. splendens grass (pseudo-R2 = 0.252; z-ratio = 2.185; p = 0.029; Figure 2B).

```{r 2B Stats}
p <- d[1:15 ,7] # Selecting 
b <- d[1:15 ,11]

glm <- glm(data = d, Birds_total15 ~ Plant_cover, family= "poisson")
summary(glm)

lm <- lm(data = d, Birds_total15 ~ Plant_cover)
summary(lm)

```

## Figure 3

<img src="img/Figure 3.png" width="400px" height="600px">

```{r Fig3A, eval=FALSE}

# First make a dataframe with just the variable we are interested in for figure 3.
t<- d[,c("Predator","Rodent","Bird_visits","Change_plantvol2", "Change_biomass")]

library(tidyverse)

t <-
  d %>%
  select("block","Predator","Rodent","Bird_visits","Change_plantvol2", "Change_biomass") %>%
  filter(Predator != "")
  


# Sort by both predator and rodent 
t
q <- t %>% group_by(Predator, Rodent) %>% 
summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())), Bird_visits) #%>% 
q

g <- ggplot(data = t, aes(y=Bird_visits, x=Predator, color=Rodent)) +
  geom_boxplot() + ylab("No.of visits by predatory birds/plot") + ylim(0, 6)
  
                 
g
```
geom_errorbar( aes(x=Predator,ymin=mean-se, ymax=mean+se), width=0.2, colour="black") 

```{r Fig3B, eval=FALSE}

r <- t %>% group_by(Predator, Rodent) %>% 
summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())), Change_plantvol2) 
r

g <- ggplot(r) +
  geom_col(aes(y=mean, x=Change_plantvol2), fill="forestgreen") +
  geom_errorbar( aes(x=Change_plantvol2, ymin=mean-se, ymax=mean+se), width=0.2, colour="black") + 
ylab("Change in plant volume (m3)") + ylim(-2, 3) #+
  #geom_signif(comparisons = list(c("No vole", "Vole")), map_signif_level = TRUE)
                 
g
```

```{r Fig3C, eval=FALSE}

s <- t %>% group_by(Predator, Rodent) %>% 
summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())), Change_biomass)
s

g <- ggplot(s) +
  geom_col(aes(y=mean, x=Change_biomass), fill="forestgreen") +
  geom_errorbar( aes(x=Change_biomass, ymin=mean-se, ymax=mean+se), width=0.2, colour="black") + 
ylab("Change in root biomass (g/m2)") + ylim(-60, 60) #+
  #geom_signif(comparisons = list(c("No vole", "Vole")), map_signif_level = TRUE)
                 
g
```

## Figure 4A

Descriptive Statistic

<img src="img/Figure 4.png" width="400px" height="600px">

```{r 4A}


o <- d[1:18, c(18, 20, 21, 24)]
o <- data.frame(sapply(o, function(x) as.numeric(as.character(x))))
head(o)

a <- o %>% group_by(Plant_cover2) %>% 
  summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())), 1:3) 
head (a)

g1 <- ggplot(a, aes(x=Plant_cover2, y=Bird_visit6_mean)) +
  geom_col(fill="blue") + 
  geom_errorbar( aes(x=Plant_cover2,ymin=Bird_visit6_mean-Bird_visit6_se, ymax=Bird_visit6_mean+Bird_visit6_se), width=0.2, colour="black") +
  xlab("A. splendens cover (%)") + ylab("No. of visits by predatory birds/plot") +
scale_x_continuous(breaks=c(0,50,100)) + ylim(0,4)
g1
```

## Figure 4B

```{r 4B}
g2 <- ggplot(a, aes(x=Plant_cover2, y=Feeding_freq_mean)) +
  geom_col(fill="blue") +
  geom_errorbar( aes(x=Plant_cover2,ymin=Feeding_freq_mean-Feeding_freq_se, ymax=Feeding_freq_mean+Feeding_freq_se), width=0.2, colour="black") +
  xlab("A. splendens cover (%)") + ylab("Feeding frequency (%)") +
  scale_x_continuous(breaks=c(0,50,100)) + scale_y_continuous(breaks=c(0, 20, 40, 60, 80, 100)) + ylim(0,100)
g2
```

## Figure 4C
```{r 4C}
g3 <- ggplot(a, aes(x=Plant_cover2, y=Vole_mortality_mean)) +
  geom_col(fill="blue") +
  geom_errorbar( aes(x=Plant_cover2,ymin=Vole_mortality_mean-Vole_mortality_se, ymax=Vole_mortality_mean+Vole_mortality_se), width=0.2, colour="black") +
xlab("A. splendens cover (%)") + ylab("Mortality rate (%)") + 
  scale_x_continuous(breaks=c(0,50,100)) + ylim(0,100)
g3

```
